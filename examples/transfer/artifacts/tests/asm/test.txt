#[test]
fn test_asm() {
    let setup = setup_test(ProgramLanguage::Assembly);

    // Set up accounts.
    let (system_program, system_account) = program::keyed_account_for_system_program();
    let system_meta = AccountMeta::new_readonly(system_program, false);
    let sender_pubkey = Pubkey::new_unique();
    let sender_meta = AccountMeta::new(sender_pubkey, true);
    let recipient_pubkey = Pubkey::new_unique();
    let recipient_meta = AccountMeta::new(recipient_pubkey, false);
    let mut recipient_account = Account::new(0, 0, &system_program);

    // Check no accounts passed.
    let mut instruction = Instruction::new_with_bytes(setup.program_id, &[], vec![]);
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &[],
        &[Check::err(ProgramError::Custom(E_N_ACCOUNTS))],
    );

    // Check nonzero sender data length.
    let mut sender_account = Account::new(0, 1, &system_program);
    instruction.accounts = vec![
        sender_meta.clone(),
        recipient_meta.clone(),
        system_meta.clone(),
    ];
    let mut accounts = vec![
        (sender_pubkey, sender_account.clone()),
        (recipient_pubkey, recipient_account.clone()),
        (system_program, system_account.clone()),
    ];
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &accounts,
        &[Check::err(ProgramError::Custom(
            E_DATA_LENGTH_NONZERO_SENDER,
        ))],
    );
    sender_account.data = vec![];
    accounts[AccountPosition::Sender as usize].1 = sender_account.clone();

    // Check duplicate recipient account.
    instruction.accounts[AccountPosition::Recipient as usize] = sender_meta.clone();
    accounts[AccountPosition::Recipient as usize] = (sender_pubkey, sender_account.clone());
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &accounts,
        &[Check::err(ProgramError::Custom(
            E_DUPLICATE_ACCOUNT_RECIPIENT,
        ))],
    );
    recipient_account.data = vec![0];
    instruction.accounts[AccountPosition::Recipient as usize] = recipient_meta.clone();

    // Check nonzero recipient data length.
    accounts[AccountPosition::Recipient as usize] = (recipient_pubkey, recipient_account.clone());
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &accounts,
        &[Check::err(ProgramError::Custom(
            E_DATA_LENGTH_NONZERO_RECIPIENT,
        ))],
    );
    recipient_account.data = vec![];
    accounts[AccountPosition::Recipient as usize].1 = recipient_account.clone();

    // Check duplicate system program account.
    instruction.accounts[AccountPosition::SystemProgram as usize] = recipient_meta.clone();
    accounts[AccountPosition::SystemProgram as usize] =
        (recipient_pubkey, recipient_account.clone());
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &accounts,
        &[Check::err(ProgramError::Custom(
            E_DUPLICATE_ACCOUNT_SYSTEM_PROGRAM,
        ))],
    );
    instruction.accounts[AccountPosition::SystemProgram as usize] = system_meta.clone();
    accounts[AccountPosition::SystemProgram as usize] = (system_program, system_account.clone());

    // Check invalid instruction data length.
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &accounts,
        &[Check::err(ProgramError::Custom(
            E_INVALID_INSTRUCTION_DATA_LENGTH,
        ))],
    );

    // Check insufficient lamports.
    instruction.data = TRANSFER_AMOUNT.to_le_bytes().to_vec();
    setup.mollusk.process_and_validate_instruction(
        &instruction,
        &accounts,
        &[Check::err(ProgramError::Custom(E_INSUFFICIENT_LAMPORTS))],
    );
}